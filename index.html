<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë¶€í’ˆ ì„ íƒê¸°</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen p-4">
  <div class="max-w-5xl mx-auto bg-white shadow-md rounded-2xl p-6">
    <div class="flex justify-between items-center mb-4">
      <h1 class="text-xl font-semibold text-gray-800">ë¶€í’ˆ ì„ íƒê¸°</h1>
      <label class="cursor-pointer text-sm bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-md">
        CSV ì—…ë¡œë“œ
        <input type="file" accept=".csv" id="fileInput" class="hidden" />
      </label>
    </div>

    <!-- ë¶€í’ˆ ë¦¬ìŠ¤íŠ¸ í…Œì´ë¸” -->
    <table class="w-full border-collapse text-sm text-left">
      <thead class="bg-gray-100 text-gray-600 border-b">
        <tr>
          <th class="p-2 w-32">ì¹´í…Œê³ ë¦¬</th>
          <th class="p-2">ë¶€í’ˆëª…</th>
          <th class="p-2 w-16">ìˆ˜ëŸ‰</th>
          <th class="p-2 w-20 text-center">ë³µì‚¬</th>
        </tr>
      </thead>
      <tbody id="partsTable" class="divide-y divide-gray-200">
        <!-- ë¡œë“œëœ ë¶€í’ˆ í–‰ì´ ì—¬ê¸° ë“¤ì–´ì˜´ -->
      </tbody>
    </table>
  </div>

  <script>
    const fileInput = document.getElementById('fileInput');
    const partsTable = document.getElementById('partsTable');

    // ğŸ“¦ í˜ì´ì§€ ë¡œë“œ ì‹œ localStorageì— ì €ì¥ëœ ë°ì´í„° ë³µì›
    window.addEventListener('load', () => {
      const savedCSV = localStorage.getItem('partsData');
      if (savedCSV) loadPartsFromCSV(savedCSV);
    });

    // ğŸ“¤ CSV ì—…ë¡œë“œ í•¸ë“¤ëŸ¬
    fileInput.addEventListener('change', (event) => {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = (e) => {
        const csvText = e.target.result;
        localStorage.setItem('partsData', csvText); // localStorageì— ì €ì¥
        loadPartsFromCSV(csvText); // í™”ë©´ ê°±ì‹ 
      };
      reader.readAsText(file);
    });

    // ğŸ“‹ CSV íŒŒì‹± & í…Œì´ë¸” ë Œë”ë§
    function loadPartsFromCSV(csvText) {
      const rows = csvText.trim().split('\n').map(r => r.split(','));
      const headers = rows[0];
      const dataRows = rows.slice(1);

      partsTable.innerHTML = ''; // ê¸°ì¡´ ë¦¬ìŠ¤íŠ¸ ë¹„ìš°ê¸°

      dataRows.forEach((cols) => {
        const part = {};
        headers.forEach((h, i) => (part[h.trim()] = cols[i]?.trim() ?? ''));

        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="p-2">${part.category || ''}</td>
          <td class="p-2">${part.name || ''}</td>
          <td class="p-2">${part.qty || ''}</td>
          <td class="p-2 text-center">
            <button class="text-blue-600 hover:text-blue-800 font-medium text-xs" 
                    onclick="copyPartInfo(this, ${JSON.stringify(part).replace(/"/g, '&quot;')})">
              ë³µì‚¬
            </button>
          </td>
        `;
        partsTable.appendChild(tr);
      });
    }

    // âœ… ë²„íŠ¼ì— í”¼ë“œë°± í‘œì‹œí•˜ëŠ” ë³µì‚¬ ê¸°ëŠ¥
    function copyPartInfo(button, part) {
      const textToCopy = `${part.category}, ${part.name}, ${part.qty}`;
      navigator.clipboard.writeText(textToCopy).then(() => {
        const originalText = button.textContent;
        button.textContent = 'ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤ âœ…';
        button.disabled = true;

        setTimeout(() => {
          button.textContent = originalText;
          button.disabled = false;
        }, 1500);
      });
    }
  </script>
</body>
</html>
