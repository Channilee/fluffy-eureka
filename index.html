<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë¶€í’ˆ ì„ íƒê¸°</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- XLSX ë¼ì´ë¸ŒëŸ¬ë¦¬ (ì—‘ì…€ íŒŒì‹±ìš©) -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body class="bg-gray-50 min-h-screen p-4">
  <div class="max-w-5xl mx-auto bg-white shadow-md rounded-2xl p-6">
    <div class="flex justify-between items-center mb-4">
      <h1 class="text-xl font-semibold text-gray-800">ë¶€í’ˆ ì„ íƒê¸°</h1>
      <label class="cursor-pointer text-sm bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-md">
        íŒŒì¼ ì—…ë¡œë“œ
        <input type="file" accept=".csv,.xlsx,.xls" id="fileInput" class="hidden" />
      </label>
    </div>

    <table class="w-full border-collapse text-sm text-left">
      <thead class="bg-gray-100 text-gray-600 border-b">
        <tr>
          <th class="p-2 w-32">ì¹´í…Œê³ ë¦¬</th>
          <th class="p-2">ë¶€í’ˆëª…</th>
          <th class="p-2 w-16">ìˆ˜ëŸ‰</th>
          <th class="p-2 w-20 text-center">ë³µì‚¬</th>
        </tr>
      </thead>
      <tbody id="partsTable" class="divide-y divide-gray-200">
        <!-- ë¶€í’ˆ ë°ì´í„°ê°€ ì—¬ê¸° í‘œì‹œë¨ -->
      </tbody>
    </table>
  </div>

  <script>
    const fileInput = document.getElementById('fileInput');
    const partsTable = document.getElementById('partsTable');

    // ğŸ”¹ í˜ì´ì§€ ë¡œë“œì‹œ localStorage ë³µì›
    window.addEventListener('load', () => {
      const savedData = localStorage.getItem('partsData');
      if (savedData) {
        try {
          const parsed = JSON.parse(savedData);
          renderTable(parsed);
        } catch {
          console.error("ì €ì¥ëœ ë°ì´í„° íŒŒì‹± ì‹¤íŒ¨");
        }
      }
    });

    // ğŸ”¹ íŒŒì¼ ì—…ë¡œë“œ ì´ë²¤íŠ¸
    fileInput.addEventListener('change', handleFileUpload);

    async function handleFileUpload(e) {
      const file = e.target.files[0];
      if (!file) return;

      const ext = file.name.split('.').pop().toLowerCase();

      if (ext === 'csv') {
        readCSV(file);
      } else if (ext === 'xlsx' || ext === 'xls') {
        readXLSX(file);
      } else {
        alert('ì§€ì›ë˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤. CSV ë˜ëŠ” XLSX íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”.');
      }
    }

    // ğŸ“˜ XLSX íŒŒì¼ ì½ê¸°
    function readXLSX(file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: 'array' });
        const firstSheetName = workbook.SheetNames[0];
        const worksheet = workbook.Sheets[firstSheetName];
        const jsonData = XLSX.utils.sheet_to_json(worksheet, { defval: '' });

        localStorage.setItem('partsData', JSON.stringify(jsonData));
        renderTable(jsonData);
      };
      reader.readAsArrayBuffer(file);
    }

    // ğŸ“„ CSV íŒŒì¼ ì½ê¸°
    function readCSV(file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        const csvText = e.target.result;
        const rows = csvText.trim().split('\n').map(r => r.split(','));
        const headers = rows[0].map(h => h.trim());
        const data = rows.slice(1).map(row => {
          const obj = {};
          headers.forEach((h, i) => obj[h] = row[i] ? row[i].trim() : '');
          return obj;
        });

        localStorage.setItem('partsData', JSON.stringify(data));
        renderTable(data);
      };
      reader.readAsText(file, 'utf-8');
    }

    // ğŸ“‹ í…Œì´ë¸” ë Œë”ë§
    function renderTable(data) {
      partsTable.innerHTML = '';
      data.forEach(part => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="p-2">${part.category || ''}</td>
          <td class="p-2">${part.name || ''}</td>
          <td class="p-2">${part.qty || ''}</td>
          <td class="p-2 text-center">
            <button class="text-blue-600 hover:text-blue-800 font-medium text-xs"
                    onclick="copyPartInfo(this, ${JSON.stringify(part).replace(/"/g, '&quot;')})">
              ë³µì‚¬
            </button>
          </td>
        `;
        partsTable.appendChild(tr);
      });
    }

    // âœ… ìì—°ìŠ¤ëŸ¬ìš´ ë³µì‚¬ í”¼ë“œë°±
    function copyPartInfo(button, part) {
      const textToCopy = `${part.category || ''}, ${part.name || ''}, ${part.qty || ''}`;
      navigator.clipboard.writeText(textToCopy).then(() => {
        const originalText = button.textContent;
        button.textContent = 'ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤ âœ…';
        button.disabled = true;
        setTimeout(() => {
          button.textContent = originalText;
          button.disabled = false;
        }, 1500);
      }).catch(err => {
        console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨:', err);
        alert('ë³µì‚¬ ê¸°ëŠ¥ì´ ì§€ì›ë˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.');
      });
    }
  </script>
</body>
</html>
