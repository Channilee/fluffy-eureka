<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>부품 선택기</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen p-4">
  <div class="max-w-5xl mx-auto bg-white shadow-md rounded-2xl p-6">
    <div class="flex justify-between items-center mb-4">
      <h1 class="text-xl font-semibold text-gray-800">부품 선택기</h1>
      <label class="cursor-pointer text-sm bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-md">
        CSV 업로드
        <input type="file" accept=".csv" id="fileInput" class="hidden" />
      </label>
    </div>

    <!-- 부품 리스트 테이블 -->
    <table class="w-full border-collapse text-sm text-left">
      <thead class="bg-gray-100 text-gray-600 border-b">
        <tr>
          <th class="p-2 w-32">카테고리</th>
          <th class="p-2">부품명</th>
          <th class="p-2 w-16">수량</th>
          <th class="p-2 w-20 text-center">복사</th>
        </tr>
      </thead>
      <tbody id="partsTable" class="divide-y divide-gray-200">
        <!-- 로드된 부품 행이 여기 들어옴 -->
      </tbody>
    </table>
  </div>

  <script>
    const fileInput = document.getElementById('fileInput');
    const partsTable = document.getElementById('partsTable');

    // 📦 페이지 로드 시 localStorage에 저장된 데이터 복원
    window.addEventListener('load', () => {
      const savedCSV = localStorage.getItem('partsData');
      if (savedCSV) loadPartsFromCSV(savedCSV);
    });

    // 📤 CSV 업로드 핸들러
    fileInput.addEventListener('change', (event) => {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = (e) => {
        const csvText = e.target.result;
        localStorage.setItem('partsData', csvText); // localStorage에 저장
        loadPartsFromCSV(csvText); // 화면 갱신
      };
      reader.readAsText(file);
    });

    // 📋 CSV 파싱 & 테이블 렌더링
    function loadPartsFromCSV(csvText) {
      const rows = csvText.trim().split('\n').map(r => r.split(','));
      const headers = rows[0];
      const dataRows = rows.slice(1);

      partsTable.innerHTML = ''; // 기존 리스트 비우기

      dataRows.forEach((cols) => {
        const part = {};
        headers.forEach((h, i) => (part[h.trim()] = cols[i]?.trim() ?? ''));

        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="p-2">${part.category || ''}</td>
          <td class="p-2">${part.name || ''}</td>
          <td class="p-2">${part.qty || ''}</td>
          <td class="p-2 text-center">
            <button class="text-blue-600 hover:text-blue-800 font-medium text-xs" 
                    onclick="copyPartInfo(this, ${JSON.stringify(part).replace(/"/g, '&quot;')})">
              복사
            </button>
          </td>
        `;
        partsTable.appendChild(tr);
      });
    }

    // ✅ 버튼에 피드백 표시하는 복사 기능
    function copyPartInfo(button, part) {
      const textToCopy = `${part.category}, ${part.name}, ${part.qty}`;
      navigator.clipboard.writeText(textToCopy).then(() => {
        const originalText = button.textContent;
        button.textContent = '복사되었습니다 ✅';
        button.disabled = true;

        setTimeout(() => {
          button.textContent = originalText;
          button.disabled = false;
        }, 1500);
      });
    }
  </script>
</body>
</html>
